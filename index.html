<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Omkar Enterprises | Investor Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#f4f6f9; }
    header { background:#2c3e50; color:white; padding:15px; display:flex; justify-content:space-between; align-items:center; }
    header h1 { font-size:20px; margin:0; }
    nav button { background:none; border:none; color:white; padding:10px 15px; cursor:pointer; }
    nav button.active { background:#1abc9c; border-radius:5px; }
    #dashboard { display:none; padding:20px; }
    .tab { display:none; }
    .tab.active { display:block; }
    #consentPopup { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; }
    #consentPopup form { background:white; padding:20px; border-radius:8px; width:300px; }
    label { display:block; margin-top:10px; }
    input { width:100%; padding:8px; margin-top:5px; }
    button { margin-top:15px; padding:10px 15px; border:none; cursor:pointer; background:#1abc9c; color:white; border-radius:5px; }
  </style>
</head>
<body>
  <!-- Consent Popup -->
  <div id="consentPopup">
    <form id="consentForm" method="POST" action="YOUR_WEBAPP_URL">
      <h2>Investor Consent</h2>
      <label>Name:</label>
      <input type="text" name="name" required>
      <label>Email:</label>
      <input type="email" name="email" required>
      <button type="submit">I Agree & Continue</button>
    </form>
  </div>

  <!-- Dashboard -->
  <div id="dashboard">
    <header>
      <h1>Omkar Enterprises | Investor Dashboard</h1>
      <div style="display:flex; align-items:center; gap:15px;">
        <span id="investorInfo" style="font-size:13px; color:#fff;"></span>
        <button id="logoutBtn">Logout</button>
      </div>
    </header>
    <nav>
      <button data-tab="home" class="active">Home</button>
      <button data-tab="terms">Investor Terms</button>
      <button data-tab="agreements">Agreements</button>
      <button data-tab="reports">Reports</button>
      <button data-tab="documents">Documents</button>
    </nav>
    <section id="home" class="tab active">
      <h2>Welcome</h2>
      <p>Welcome to Omkar Enterprises Investor Relations. Here you can view information about our consultancy firm, investor terms, and official documents.</p>
    </section>
    <section id="terms" class="tab">
      <h2>Investor Terms</h2>
      <p>Details about investor terms will be displayed here.</p>
    </section>
    <section id="agreements" class="tab">
      <h2>Agreements</h2>
      <p>Investor agreements and related content.</p>
    </section>
    <section id="reports" class="tab">
      <h2>Reports</h2>
      <p>Quarterly and annual reports will be shown here.</p>
    </section>
    <section id="documents" class="tab">
      <h2>Documents</h2>
      <p>Important investor documents and resources.</p>
    </section>
  </div>

  <script>
    const consentPopup = document.getElementById("consentPopup");
    const dashboard = document.getElementById("dashboard");
    const logoutBtn = document.getElementById("logoutBtn");
    const investorInfo = document.getElementById("investorInfo");
    const WEBAPP_URL = "YOUR_WEBAPP_URL"; // replace with deployed script URL

    // On load: check localStorage first
    window.onload = async function() {
      let email = localStorage.getItem("investorEmail");
      if (email) {
        await fetchInvestorData(email);
      } else {
        consentPopup.style.display = "flex";
      }
    };

    // Fetch investor details from Google Sheet
    async function fetchInvestorData(email) {
      try {
        const res = await fetch(`${WEBAPP_URL}?email=${encodeURIComponent(email)}`);
        const data = await res.json();
        if (data.success) {
          investorInfo.textContent = `${data.name} (${data.email})`;
          dashboard.style.display = "block";
          consentPopup.style.display = "none";
        } else {
          consentPopup.style.display = "flex";
        }
      } catch (err) {
        console.error("Fetch error:", err);
        consentPopup.style.display = "flex";
      }
    }

    // Handle consent submit
    document.getElementById("consentForm").addEventListener("submit", function(e) {
      let email = document.querySelector("input[name=email]").value;
      let name = document.querySelector("input[name=name]").value;

      localStorage.setItem("investorEmail", email);
      localStorage.setItem("investorName", name);

      setTimeout(() => {
        fetchInvestorData(email);
        alert("Consent recorded successfully!");
      }, 800);
    });

    // Tab switching
    const buttons = document.querySelectorAll("nav button");
    const tabs = document.querySelectorAll(".tab");
    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        buttons.forEach(b => b.classList.remove("active"));
        tabs.forEach(t => t.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById(btn.dataset.tab).classList.add("active");
      });
    });

    // Logout clears consent
    logoutBtn.addEventListener("click", () => {
      localStorage.clear();
      dashboard.style.display = "none";
      consentPopup.style.display = "flex";
      investorInfo.textContent = "";
      alert("You have logged out. Please provide consent again to continue.");
    });
  </script>
</body>
</html>
