<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Omkar Investor Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { background-color: #f8f9fa; }
.dashboard-card { border-radius: 1rem; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
</style>
</head>
<body>

<div class="container py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">Omkar Enterprises Investor Relations</h2>
    <button class="btn btn-outline-danger" id="logoutBtn">Logout</button>
  </div>

  <!-- Tabs -->
  <ul class="nav nav-tabs" id="dashboardTabs">
    <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#overview">Overview</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#investor">My Investments</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#agreement">Agreements</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#earnings">How You Earn</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#hotdeals">Hot Deals</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#faq">FAQ</a></li>
  </ul>

  <div class="tab-content pt-4">

    <!-- Overview for New Visitors -->
    <div class="tab-pane fade show active" id="overview">
      <div id="visitorOverview">
        <div class="row g-3 mb-4">
          <div class="col-md-4">
            <div class="p-3 bg-white dashboard-card text-center">
              <h5>Total Investments</h5>
              <h3 id="totalInvestments">₹0</h3>
            </div>
          </div>
          <div class="col-md-4">
            <div class="p-3 bg-white dashboard-card text-center">
              <h5>Total Payouts</h5>
              <h3 id="totalPayouts">₹0</h3>
            </div>
          </div>
          <div class="col-md-4">
            <div class="p-3 bg-white dashboard-card text-center">
              <h5>Active Investors</h5>
              <h3 id="activeInvestors">0</h3>
            </div>
          </div>
        </div>

        <!-- Charts -->
        <div class="row g-3">
          <div class="col-md-6">
            <div class="p-3 bg-white dashboard-card">
              <h6>Investments vs Payouts</h6>
              <canvas id="investmentChart"></canvas>
            </div>
          </div>
          <div class="col-md-6">
            <div class="p-3 bg-white dashboard-card">
              <h6>Investor Tenure Distribution</h6>
              <canvas id="tenureChart"></canvas>
            </div>
          </div>
        </div>

        <div class="mt-4">
          <a href="sample-agreement.pdf" class="btn btn-primary" target="_blank">View Sample Agreement</a>
        </div>
      </div>
    </div>

    <!-- Investor Dashboard -->
    <div class="tab-pane fade" id="investor">
      <div id="investorDashboard">
        <div class="p-3 bg-white dashboard-card">
          <h5 class="mb-3">Welcome, <span id="investorName">Investor</span></h5>
          <p><strong>Email:</strong> <span id="investorEmail"></span></p>
          <p><strong>Phone:</strong> <span id="investorPhone"></span></p>
          <p><strong>Consent:</strong> <span id="investorConsent"></span></p>
        </div>
      </div>
    </div>

    <!-- Agreements -->
    <div class="tab-pane fade" id="agreement">
      <div class="p-3 bg-white dashboard-card">
        <h5>Your Agreements</h5>
        <p>Download your signed agreements here (coming soon).</p>
      </div>
    </div>

    <!-- Earnings -->
    <div class="tab-pane fade" id="earnings">
      <div class="p-3 bg-white dashboard-card">
        <h5>How You Earn</h5>
        <p>Investors earn fixed monthly returns through structured lending opportunities. Payouts are consistent and secured with agreements.</p>
      </div>
    </div>

    <!-- Hot Deals -->
    <div class="tab-pane fade" id="hotdeals">
      <div class="p-3 bg-white dashboard-card">
        <h5>Hot Deals</h5>
        <form id="hotdealForm">
          <input type="text" id="hdName" placeholder="Full Name" required class="form-control mb-2">
          <input type="email" id="hdEmail" placeholder="Email" required class="form-control mb-2">
          <input type="tel" id="hdPhone" placeholder="Phone" required class="form-control mb-2">
          <input type="number" id="hdAmount" placeholder="Amount" required class="form-control mb-2">
          <input type="text" id="hdTenure" placeholder="Tenure" required class="form-control mb-2">
          <button type="submit" class="btn btn-success">Submit Hot Deal</button>
        </form>
        <div id="hotdealMsg" class="mt-2"></div>
      </div>
    </div>

    <!-- FAQ -->
    <div class="tab-pane fade" id="faq">
      <div class="p-3 bg-white dashboard-card">
        <h5>FAQ</h5>
        <ul id="faqList"></ul>
      </div>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const scriptURL = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec";
const logoutBtn = document.getElementById('logoutBtn');

// Charts
const ctx1 = document.getElementById('investmentChart');
new Chart(ctx1, { type:'bar', data:{ labels:['Jan','Feb','Mar','Apr','May','Jun'], datasets:[{ label:'Investments', data:[5,7,9,12,15,18]},{ label:'Payouts', data:[1,2,3,4,5,6]}] } });
const ctx2 = document.getElementById('tenureChart');
new Chart(ctx2, { type:'pie', data:{ labels:['Quarterly','Biannual','Annual'], datasets:[{ data:[40,30,30] }] } });

// Logout
logoutBtn.addEventListener('click', ()=>{ localStorage.removeItem("investorEmail"); window.location.reload(); });

// Hot Deal submission
document.getElementById('hotdealForm').addEventListener('submit', e=>{
  e.preventDefault();
  fetch(scriptURL, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      action:'hotdeal',
      name: document.getElementById('hdName').value,
      email: document.getElementById('hdEmail').value,
      phone: document.getElementById('hdPhone').value,
      amount: document.getElementById('hdAmount').value,
      tenure: document.getElementById('hdTenure').value
    })
  }).then(r=>r.json()).then(data=>{
    document.getElementById('hotdealMsg').innerText = 'Hot Deal submitted successfully!';
    document.getElementById('hotdealForm').reset();
  }).catch(err=>console.error(err));
});

// FAQ load
fetch(scriptURL+'?action=faq')
.then(r=>r.json())
.then(faq=>{
  const faqList = document.getElementById('faqList');
  faq.forEach(f=>{ faqList.innerHTML += `<li><strong>${f.question}</strong> ${f.answer}</li>`; });
});

// Visitor vs Investor view
window.onload = function(){
  let email = localStorage.getItem("investorEmail");
  if(email){
    fetch(scriptURL+'?email='+encodeURIComponent(email))
    .then(r=>r.json())
    .then(data=>{
      if(data.exists){
        document.getElementById('investorDashboard').style.display='block';
        document.getElementById('investorName').innerText = data.name;
        document.getElementById('investorEmail').innerText = data.email;
        document.getElementById('investorPhone').innerText = data.phone;
        document.getElementById('investorConsent').innerText = data.consent;
        document.getElementById('visitorOverview').style.display='none';
      } else {
        document.getElementById('visitorOverview').style.display='block';
        document.getElementById('investorDashboard').style.display='none';
      }
    });
  } else {
    document.getElementById('visitorOverview').style.display='block';
    document.getElementById('investorDashboard').style.display='none';
  }

  // Load totals for visitor overview
  fetch(scriptURL+'?action=totals')
  .then(r=>r.json())
  .then(data=>{
    document.getElementById('totalInvestments').innerText = '₹'+data.totalFunds.toLocaleString();
    document.getElementById('totalPayouts').innerText = '₹'+data.totalPayouts.toLocaleString();
    document.getElementById('activeInvestors').innerText = data.investors;
  });
};
</script>
</body>
</html>
