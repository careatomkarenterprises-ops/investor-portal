<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Investor Relations | Omkar Enterprises</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; }
    #consentPopup {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.85); display: none;
      align-items: center; justify-content: center; z-index: 9999;
    }
    #consentBox {
      background: #fff; padding: 20px; border-radius: 10px;
      width: 90%; max-width: 400px; text-align: center;
    }
    #consentBox h2 { margin-top: 0; color:#0A2540; }
    #consentBox input, #consentBox button {
      width: 90%; margin: 8px 0; padding: 10px; font-size: 14px;
    }
    #consentBox button {
      background: #0A2540; color: #fff; border: none; border-radius: 5px; cursor: pointer;
    }
    #consentBox button:hover { background: #C9A227; color:#000; }
  </style>
</head>
<body>

<!-- Consent Popup (UNCHANGED) -->
<div id="consentPopup">
  <div id="consentBox">
    <h2>Consent Required</h2>
    <p>
      Omkar Enterprises is a private consultancy firm.<br>
      We are not a bank or NBFC and do not raise public deposits under the 
      <b>Companies Act, 2013</b> or the <b>BUDS Act, 2019</b>.<br>
      This discussion is strictly private and contractual.
    </p>
    <form id="consentForm" method="POST" action="https://script.google.com/macros/s/AKfycbynp8VHTHNb82RMWZKv1UHVV46M_TmtdRRT1_01A-XeQ7WxnRA4wMBdq6mc-wGpBQw_/exec">
      <label style="font-size:13px;">
        <input type="checkbox" name="consent" value="true" required>
        I have read, understood, and voluntarily consent to proceed.
      </label><br><br>
      <input type="text" name="name" placeholder="Full Name" required><br>
      <input type="email" name="email" placeholder="Email Address" required><br>
      <input type="tel" name="phone" placeholder="Contact Number" required><br>
      <button type="submit">Proceed</button>
    </form>
  </div>
</div>

<!-- Main Dashboard -->
<div id="mainContent" style="display:none;">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Omkar Enterprises</a>
      <button class="btn btn-outline-light" id="logoutBtn">Logout</button>
    </div>
  </nav>

  <div class="container mt-4">
    <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
      <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#overview" type="button">Overview</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#hotdeals" type="button">Hot Deals</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#faq" type="button">FAQ</button></li>
      <li class="nav-item investor-only"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#mydata" type="button">My Dashboard</button></li>
      <li class="nav-item investor-only"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#docs" type="button">Documents</button></li>
    </ul>

    <div class="tab-content mt-3">
      <!-- Overview -->
      <div class="tab-pane fade show active" id="overview" role="tabpanel">
        <h3>Company Performance</h3>
        <div class="row">
          <div class="col-md-4"><div class="card p-3 shadow-sm"><h5>Total Funds Raised</h5><p id="totalFunds">₹0</p></div></div>
          <div class="col-md-4"><div class="card p-3 shadow-sm"><h5>Total Payouts</h5><p id="totalPayouts">₹0</p></div></div>
          <div class="col-md-4"><div class="card p-3 shadow-sm"><h5>Investors Served</h5><p id="investorsCount">0</p></div></div>
        </div>
        <canvas id="performanceChart" class="mt-4"></canvas>
      </div>

      <!-- Hot Deals -->
      <div class="tab-pane fade" id="hotdeals" role="tabpanel">
        <h3>Hot Deals</h3>
        <div class="row" id="hotDealsList">
          <div class="col-md-4">
            <div class="card p-3 shadow-sm">
              <h5>Monthly Payout Scheme</h5>
              <p>Earn fixed monthly interest on your lending.</p>
              <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#enquiryModal">Invest Now</button>
            </div>
          </div>
        </div>
      </div>

      <!-- FAQ -->
      <div class="tab-pane fade" id="faq" role="tabpanel">
        <h3>Frequently Asked Questions</h3>
        <div id="faqContent"></div>
      </div>

      <!-- Investor Dashboard -->
      <div class="tab-pane fade investor-only" id="mydata" role="tabpanel">
        <h3>My Investment</h3>
        <p><b>Name:</b> <span id="invName"></span></p>
        <p><b>Email:</b> <span id="invEmail"></span></p>
        <p><b>Phone:</b> <span id="invPhone"></span></p>
        <p><b>Investment:</b> ₹<span id="invAmount"></span></p>
        <p><b>Payout Cycle:</b> <span id="invCycle"></span></p>
        <canvas id="myPerformanceChart"></canvas>
      </div>

      <!-- Investor Documents -->
      <div class="tab-pane fade investor-only" id="docs" role="tabpanel">
        <h3>Documents</h3>
        <button class="btn btn-primary mb-2" id="downloadAgreement">Download Agreement</button>
        <button class="btn btn-success" id="downloadTDS">Download TDS Certificate</button>
      </div>
    </div>
  </div>
</div>

<!-- Enquiry Modal -->
<div class="modal fade" id="enquiryModal" tabindex="-1">
  <div class="modal-dialog">
    <form class="modal-content" method="POST" action="https://script.google.com/macros/s/AKfycbynp8VHTHNb82RMWZKv1UHVV46M_TmtdRRT1_01A-XeQ7WxnRA4wMBdq6mc-wGpBQw_/exec">
      <div class="modal-header"><h5 class="modal-title">Hot Deal Enquiry</h5></div>
      <div class="modal-body">
        <input type="hidden" name="action" value="hotdeal">
        <input type="text" name="name" class="form-control mb-2" placeholder="Full Name" required>
        <input type="email" name="email" class="form-control mb-2" placeholder="Email" required>
        <input type="tel" name="phone" class="form-control mb-2" placeholder="Phone" required>
        <input type="number" name="amount" class="form-control mb-2" placeholder="Investment Amount" required>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">Submit</button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbynp8VHTHNb82RMWZKv1UHVV46M_TmtdRRT1_01A-XeQ7WxnRA4wMBdq6mc-wGpBQw_/exec"; // keep same Apps Script URL

// Show/hide investor-only tabs
window.onload = function() {
  let email = localStorage.getItem("investorEmail");
  if (email) {
    fetch(scriptURL + "?email=" + encodeURIComponent(email))
      .then(r => r.json())
      .then(data => {
        if (data.exists) {
          document.querySelectorAll(".investor-only").forEach(el => el.style.display = "block");
        } else {
          document.querySelectorAll(".investor-only").forEach(el => el.style.display = "none");
        }
        document.getElementById("mainContent").style.display = "block";
      });
  } else {
    document.getElementById("consentPopup").style.display = "flex";
  }
};

// Logout
document.getElementById("logoutBtn").addEventListener("click", () => {
  localStorage.removeItem("investorEmail");
  location.reload();
});

// FAQ Content
const visitorFAQ = `
  <div class="accordion" id="visitorFAQ">
    <div class="accordion-item"><h2 class="accordion-header">
      <button class="accordion-button" data-bs-toggle="collapse" data-bs-target="#q1">How do I start lending?</button>
    </h2><div id="q1" class="accordion-collapse collapse"><div class="accordion-body">You can start with our hot deals instantly.</div></div></div>
    <div class="accordion-item"><h2 class="accordion-header">
      <button class="accordion-button" data-bs-toggle="collapse" data-bs-target="#q2">What returns can I expect?</button>
    </h2><div id="q2" class="accordion-collapse collapse"><div class="accordion-body">Returns depend on the scheme. Average fixed monthly returns apply.</div></div></div>
  </div>
`;
const investorFAQ = `
  <div class="accordion" id="investorFAQ">
    <div class="accordion-item"><h2 class="accordion-header">
      <button class="accordion-button" data-bs-toggle="collapse" data-bs-target="#q1i">When is my next payout?</button>
    </h2><div id="q1i" class="accordion-collapse collapse"><div class="accordion-body">Check your dashboard for the payout cycle details.</div></div></div>
    <div class="accordion-item"><h2 class="accordion-header">
      <button class="accordion-button" data-bs-toggle="collapse" data-bs-target="#q2i">How can I get my TDS certificate?</button>
    </h2><div id="q2i" class="accordion-collapse collapse"><div class="accordion-body">Download from the Documents tab anytime.</div></div></div>
  </div>
`;
document.getElementById("faqContent").innerHTML = visitorFAQ; // default

// Buttons for document download
document.getElementById("downloadAgreement").addEventListener("click", () => {
  let email = localStorage.getItem("investorEmail");
  window.open(`${scriptURL}?action=download&type=agreement&email=${encodeURIComponent(email)}`, "_blank");
});
document.getElementById("downloadTDS").addEventListener("click", () => {
  let email = localStorage.getItem("investorEmail");
  window.open(`${scriptURL}?action=download&type=tds&email=${encodeURIComponent(email)}`, "_blank");
});

// Charts (static demo – later link to Sheet)
new Chart(document.getElementById("performanceChart"), {
  type: 'line',
  data: { labels: ["Jan","Feb","Mar"], datasets:[{ label:"Payouts", data:[10000,12000,15000] }] }
});
new Chart(document.getElementById("myPerformanceChart"), {
  type: 'bar',
  data: { labels: ["Jan","Feb","Mar"], datasets:[{ label:"My Payouts", data:[2000,2500,2600] }] }
});
</script>
</body>
</html>
