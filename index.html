<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Omkar Enterprises - Investor Relations</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --primary: #0A2540;
  --secondary: #C9A227;
  --light: #f8f9fa;
  --dark: #212529;
  --success: #28a745;
  --warning: #ffc107;
  --danger: #dc3545;
  --gray: #6c757d;
  --light-gray: #e9ecef;
}

body { 
  background-color: var(--light); 
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.dashboard-card { 
  border-radius: 1rem; 
  box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075); 
  transition: all 0.3s ease;
  border: none;
}

.dashboard-card:hover {
  box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
  transform: translateY(-2px);
}

#consentPopup { 
  display: none; 
  position: fixed; 
  top:0; 
  left:0; 
  width:100%; 
  height:100%; 
  background: rgba(0,0,0,0.7); 
  align-items:center; 
  justify-content:center; 
  z-index:9999; 
}

#consentBox { 
  background:#fff; 
  padding:30px; 
  border-radius:15px; 
  width:90%; 
  max-width:600px; 
  text-align:center; 
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  max-height: 90vh;
  overflow-y: auto;
}

#consentBox input, #consentBox button { 
  width: 100%; 
  margin: 10px 0; 
  padding:12px; 
  border-radius: 8px;
  border: 1px solid #ddd;
}

#consentBox button { 
  background:var(--primary); 
  color:#fff; 
  border:none; 
  font-weight: 600;
  cursor:pointer; 
  transition: all 0.3s;
}

#consentBox button:hover { 
  background:var(--secondary); 
  color:#000; 
}

.navbar-header { 
  display:flex; 
  justify-content:space-between; 
  align-items:center; 
  margin-bottom:20px; 
  padding: 15px 0;
  border-bottom: 1px solid var(--light-gray);
}

.navbar-header h2 { 
  margin:0; 
  color: var(--primary);
  font-weight: 700;
}

.nav-tabs .nav-link {
  color: var(--gray);
  font-weight: 500;
  border: none;
  padding: 12px 20px;
  border-radius: 8px 8px 0 0;
}

.nav-tabs .nav-link.active {
  color: var(--primary);
  background-color: white;
  border-bottom: 3px solid var(--secondary);
  font-weight: 600;
}

.nav-tabs .nav-link:hover {
  color: var(--primary);
  border-color: transparent;
}

.stat-card {
  text-align: center;
  padding: 20px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  transition: all 0.3s;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.stat-card h5 {
  color: var(--gray);
  font-size: 0.9rem;
  margin-bottom: 10px;
  font-weight: 600;
}

.stat-card h3 {
  color: var(--primary);
  font-weight: 700;
  margin: 0;
}

.investment-item {
  border-left: 4px solid var(--secondary);
  padding: 15px;
  margin-bottom: 15px;
  background: white;
  border-radius: 0 8px 8px 0;
}

.investment-item h6 {
  margin: 0 0 5px 0;
  color: var(--primary);
}

.investment-item p {
  margin: 0;
  color: var(--gray);
  font-size: 0.9rem;
}

.badge-status {
  padding: 5px 10px;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 600;
}

.badge-active {
  background-color: rgba(40, 167, 69, 0.1);
  color: var(--success);
}

.badge-pending {
  background-color: rgba(255, 193, 7, 0.1);
  color: var(--warning);
}

.badge-completed {
  background-color: rgba(108, 117, 125, 0.1);
  color: var(--gray);
}

.timeline {
  position: relative;
  padding-left: 30px;
}

.timeline::before {
  content: '';
  position: absolute;
  left: 15px;
  top: 0;
  bottom: 0;
  width: 2px;
  background: var(--light-gray);
}

.timeline-item {
  position: relative;
  margin-bottom: 20px;
}

.timeline-item::before {
  content: '';
  position: absolute;
  left: -24px;
  top: 5px;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--secondary);
  border: 2px solid white;
  box-shadow: 0 0 0 2px var(--secondary);
}

.timeline-date {
  font-size: 0.8rem;
  color: var(--gray);
}

.timeline-content {
  background: white;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.loading {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 200px;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 4px solid rgba(0, 0, 0, 0.1);
  border-left-color: var(--secondary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.alert-custom {
  border-left: 4px solid var(--secondary);
  border-radius: 8px;
}

.hot-deal-card {
  border: 1px solid var(--secondary);
  border-radius: 12px;
  overflow: hidden;
  transition: all 0.3s;
}

.hot-deal-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 20px rgba(201, 162, 39, 0.2);
}

.hot-deal-badge {
  position: absolute;
  top: 15px;
  right: 15px;
  background: var(--danger);
  color: white;
  padding: 5px 10px;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
}

.faq-item {
  margin-bottom: 15px;
  border-radius: 8px;
  overflow: hidden;
}

.faq-question {
  background: white;
  padding: 15px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: 600;
  color: var(--primary);
}

.faq-answer {
  background: var(--light-gray);
  padding: 0 15px;
  max-height: 0;
  overflow: hidden;
  transition: all 0.3s ease;
}

.faq-item.active .faq-answer {
  padding: 15px;
  max-height: 500px;
}

.footer {
  margin-top: 40px;
  padding: 20px 0;
  border-top: 1px solid var(--light-gray);
  color: var(--gray);
  font-size: 0.9rem;
  text-align: center;
}

.legal-text {
  font-size: 0.85rem;
  line-height: 1.5;
  text-align: left;
  background: #fff8e1;
  padding: 15px;
  border-radius: 8px;
  border-left: 4px solid var(--warning);
}

.risk-warning {
  background: #fff3cd;
  border-color: var(--warning);
  color: #856404;
}

.visitor-only, .investor-only {
  display: none;
}

.visitor-view .visitor-only {
  display: block;
}

.investor-view .investor-only {
  display: block;
}

@media (max-width: 768px) {
  .navbar-header {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .navbar-header h2 {
    margin-bottom: 10px;
  }
  
  .nav-tabs .nav-link {
    padding: 10px 15px;
    font-size: 0.9rem;
  }
  
  #consentBox {
    padding: 20px;
    margin: 20px;
  }
}
</style>
</head>
<body>

<!-- Consent Popup -->
<div id="consentPopup">
  <div id="consentBox">
    <h2 class="mb-4"><i class="fas fa-scale-balanced me-2"></i>Legal Consent Required</h2>
    <div class="alert alert-warning mb-4">
      <p class="mb-3"><strong>Important Legal Disclaimer - Read Carefully</strong></p>
      <div class="legal-text">
        <p><strong>Please read this carefully before proceeding:</strong></p>
        
        <p>✅ I confirm that I am voluntarily engaging in this private enquiry with Omkar Enterprises.</p>
        
        <p>✅ I understand that Omkar Enterprises is not a bank, NBFC, or deposit-taking company under the Companies Act, 2013 or the Banning of Unregulated Deposit Schemes Act, 2019.</p>
        
        <p>✅ I acknowledge that this enquiry is for private contractual arrangements only and does not constitute a public deposit, collective investment scheme, or fundraising invitation.</p>
        
        <p>✅ I agree that all discussions are confidential and subject to formal agreement before any transaction.</p>
        
        <p><strong>Investment Risk Acknowledgement:</strong></p>
        <p>✅ I understand that all investments carry risks, including potential loss of principal capital.</p>
        <p>✅ I acknowledge that returns are not guaranteed and may vary based on business performance.</p>
        <p>✅ I understand that there may be delays in returns or repayments due to business conditions.</p>
        <p>✅ I confirm I am investing capital I can afford to risk.</p>
        <p>✅ I understand that past performance doesn't guarantee future results.</p>
        
        <p class="mt-3"><strong>Proprietorship Structure Acknowledgement:</strong></p>
        <p>✅ I understand that Omkar Enterprises operates as a sole proprietorship under Indian laws.</p>
        <p>✅ I acknowledge that all investments are personal contractual arrangements between me and the proprietor.</p>
        <p>✅ I understand the proprietor's personal liability extends to all business obligations.</p>
        
        <p class="mt-3"><em>By proceeding, I acknowledge I have read and understood all the above points and accept all associated risks.</em></p>
      </div>
    </div>
    <form id="consentForm">
      <div class="form-check mb-3 text-start">
        <input class="form-check-input" type="checkbox" id="agreeCheck" required>
        <label class="form-check-label" for="agreeCheck">
          <strong>I agree to all terms, conditions, and risk disclosures stated above</strong>
        </label>
      </div>
      <input type="text" id="name" class="form-control" placeholder="Full Legal Name" required>
      <input type="email" id="email" class="form-control" placeholder="Email Address" required>
      <input type="tel" id="phone" class="form-control" placeholder="Contact Number" required minlength="10" maxlength="10" pattern="[6-9][0-9]{9}">
      <div class="alert alert-info mt-3">
        <small>
          <strong>Record Keeping:</strong> All consent records and transactions will be maintained for 5+ years as per regulatory requirements. You can request copies of your documents anytime.
        </small>
      </div>
      <button type="submit" class="btn mt-3">
        <i class="fas fa-check-circle me-2"></i>Accept & Proceed to Dashboard
      </button>
    </form>
    <p class="mt-3 small text-muted">
      <i class="fas fa-envelope me-1"></i>Need clarification? Contact: legal@omkarenterprises.com
    </p>
  </div>
</div>

<!-- Dashboard Container -->
<div class="container py-4" id="dashboardContent">
  <div class="navbar-header">
    <div class="d-flex align-items-center">
      <!-- Replace with your actual logo path -->
      <img src="assets/logo.png" alt="Omkar Logo" style="height:40px; width:auto; margin-right:10px;">
      <h2 class="mb-0">Omkar Enterprises Investor Relations</h2>
    </div>
    <div class="investor-only">
      <span id="headerInvestorName" class="me-3 fw-bold"></span>
      <button class="btn btn-outline-danger btn-sm" id="logoutBtn"><i class="fas fa-sign-out-alt me-1"></i>Logout</button>
    </div>
  </div>

  <ul class="nav nav-tabs" id="dashboardTabs">
    <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#overview"><i class="fas fa-tachometer-alt me-1"></i>Overview</a></li>
    <li class="nav-item investor-only"><a class="nav-link" data-bs-toggle="tab" href="#investor"><i class="fas fa-user me-1"></i>My Investments</a></li>
    <li class="nav-item investor-only"><a class="nav-link" data-bs-toggle="tab" href="#agreement"><i class="fas fa-file-contract me-1"></i>Agreements</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#earnings"><i class="fas fa-money-bill-wave me-1"></i>How You Earn</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#risk"><i class="fas fa-exclamation-triangle me-1"></i>Risk Disclosure</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#hotdeals"><i class="fas fa-fire me-1"></i>Investment Opportunities</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#faq"><i class="fas fa-question-circle me-1"></i>FAQ</a></li>
  </ul>

  <div class="tab-content pt-4">
    <!-- Overview Tab -->
    <div class="tab-pane fade show active" id="overview">
      <!-- Visitor Overview -->
      <div class="visitor-only">
        <div class="alert alert-warning alert-custom mb-4">
          <h6><i class="fas fa-exclamation-triangle me-2"></i>Important Notice</h6>
          <p class="mb-0">This is a private investor portal. All investments are subject to signed agreements and carry risks. Please read the Risk Disclosure tab before proceeding.</p>
        </div>
        
        <div class="row g-3 mb-4">
          <div class="col-md-3">
            <div class="stat-card">
              <h5>Total Investments</h5>
              <h3 id="totalInvestments">₹2.8Cr</h3>
              <p class="text-muted small mt-2">All time</p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card">
              <h5>Total Payouts</h5>
              <h3 id="totalPayouts">₹32L</h3>
              <p class="text-muted small mt-2">All time</p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card">
              <h5>Active Investors</h5>
              <h3 id="activeInvestors">47</h3>
              <p class="text-muted small mt-2">Currently active</p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card">
              <h5>Avg. Returns</h5>
              <h3 id="avgReturns">12.5%</h3>
              <p class="text-muted small mt-2">Annualized</p>
            </div>
          </div>
        </div>
        
        <div class="row g-3 mb-4">
          <div class="col-md-8">
            <div class="p-3 bg-white dashboard-card">
              <h6 class="mb-3">Investments vs Payouts</h6>
              <canvas id="investmentChart" height="250"></canvas>
            </div>
          </div>
          <div class="col-md-4">
            <div class="p-3 bg-white dashboard-card">
              <h6 class="mb-3">Investor Tenure Distribution</h6>
              <canvas id="tenureChart" height="250"></canvas>
            </div>
          </div>
        </div>
        
        <div class="row">
          <div class="col-12">
            <div class="p-3 bg-white dashboard-card">
              <h6 class="mb-3">Why Choose Omkar Enterprises?</h6>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <div class="text-center p-3">
                    <i class="fas fa-shield-alt fa-2x text-primary mb-2"></i>
                    <h6>Secure Investments</h6>
                    <p class="small text-muted">Legally binding agreements with proper collateral</p>
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <div class="text-center p-3">
                    <i class="fas fa-chart-line fa-2x text-success mb-2"></i>
                    <h6>Consistent Returns</h6>
                    <p class="small text-muted">Proven track record of 12-15% annual returns</p>
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <div class="text-center p-3">
                    <i class="fas fa-handshake fa-2x text-warning mb-2"></i>
                    <h6>Transparent Process</h6>
                    <p class="small text-muted">Complete visibility into your investment journey</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Investor Overview -->
      <div class="investor-only">
        <div class="row g-3 mb-4">
          <div class="col-md-3">
            <div class="stat-card">
              <h5>My Investments</h5>
              <h3 id="myTotalInvestments">₹0</h3>
              <p class="text-muted small mt-2">All time</p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card">
              <h5>My Payouts</h5>
              <h3 id="myTotalPayouts">₹0</h3>
              <p class="text-muted small mt-2">All time</p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card">
              <h5>Current Value</h5>
              <h3 id="currentValue">₹0</h3>
              <p class="text-muted small mt-2">Portfolio value</p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card">
              <h5>Next Payout</h5>
              <h3 id="nextPayoutDate">-</h3>
              <p class="text-muted small mt-2">Estimated date</p>
            </div>
          </div>
        </div>
        
        <div class="row g-3 mb-4">
          <div class="col-md-8">
            <div class="p-3 bg-white dashboard-card">
              <h6 class="mb-3">My Investment Growth</h6>
              <canvas id="myInvestmentChart" height="250"></canvas>
            </div>
          </div>
          <div class="col-md-4">
            <div class="p-3 bg-white dashboard-card">
              <h6 class="mb-3">My Portfolio Allocation</h6>
              <canvas id="portfolioChart" height="250"></canvas>
            </div>
          </div>
        </div>
        
        <div class="row">
          <div class="col-md-6">
            <div class="p-3 bg-white dashboard-card">
              <h6 class="mb-3">My Recent Investments</h6>
              <div id="myRecentInvestments">
                <div class="loading">
                  <div class="spinner"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="p-3 bg-white dashboard-card">
              <h6 class="mb-3">Upcoming Payouts</h6>
              <div id="upcomingPayouts">
                <div class="loading">
                  <div class="spinner"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Remaining tabs (Investor, Agreements, Earnings, Risk, Hot Deals, FAQ) -->
    <!-- Keep the existing tab content from your file but add investor-only class to investor-specific tabs -->
    
    <!-- Investor Tab -->
    <div class="tab-pane fade investor-only" id="investor">
      <!-- Your existing investor tab content -->
    </div>

    <!-- Agreements Tab -->
    <div class="tab-pane fade investor-only" id="agreement">
      <!-- Your existing agreements tab content -->
    </div>

    <!-- Keep other tabs as they are (they are visible to both visitors and investors) -->
    <div class="tab-pane fade" id="earnings">
      <!-- Your existing earnings tab content -->
    </div>

    <div class="tab-pane fade" id="risk">
      <!-- Your existing risk disclosure tab content -->
    </div>

    <div class="tab-pane fade" id="hotdeals">
      <!-- Your existing hot deals tab content -->
    </div>

    <div class="tab-pane fade" id="faq">
      <!-- Your existing FAQ tab content -->
    </div>
  </div>
  
  <div class="footer">
    <p>© 2023 Omkar Enterprises. All rights reserved. | 
      <a href="#" class="text-muted">Privacy Policy</a> | 
      <a href="#" class="text-muted">Terms of Service</a> |
      <a href="#" class="text-muted" data-bs-toggle="tab" href="#risk">Risk Disclosure</a>
    </p>
    <p class="small">
      <strong>Legal Disclaimer:</strong> Omkar Enterprises is a private consultancy firm and not a bank or NBFC. 
      All investments are private contractual arrangements subject to individual agreements. 
      Investments carry risks including potential loss of principal. Past performance doesn't guarantee future returns. 
      Please read all agreement documents carefully before investing.
    </p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Replace with your actual Google Apps Script URL
const scriptURL = "https://script.google.com/macros/s/AKfycbwsAG2uqUswgkZ8U3yhBUz7K9T5X9O_WZRssXEuQVcpxF7HGnPbQWkhf1dhj-_moDui/exec";

// DOM Elements
const consentPopup = document.getElementById("consentPopup");
const dashboardContent = document.getElementById("dashboardContent");

// Investment limits for proprietorship
const investmentLimits = {
  minInvestment: 50000, // ₹50,000
  maxInvestment: 2000000, // ₹20 Lakhs
  maxInvestors: 50
};

// Initialize the dashboard
function initDashboard() {
  initCharts();
  setupEventListeners();
  initFAQ();
  
  const investorEmail = localStorage.getItem("investorEmail");
  if (investorEmail) {
    switchToInvestorView();
    loadInvestorData(investorEmail);
  } else {
    switchToVisitorView();
    loadOverviewData();
  }
}

// Switch between visitor and investor views
function switchToInvestorView() {
  document.body.classList.remove('visitor-view');
  document.body.classList.add('investor-view');
  consentPopup.style.display = 'none';
}

function switchToVisitorView() {
  document.body.classList.remove('investor-view');
  document.body.classList.add('visitor-view');
  
  const investorEmail = localStorage.getItem("investorEmail");
  if (!investorEmail) {
    consentPopup.style.display = 'flex';
  }
}

// Initialize charts
function initCharts() {
  // Visitor Charts
  const ctx1 = document.getElementById('investmentChart')?.getContext('2d');
  if (ctx1) {
    new Chart(ctx1, {
      type: 'bar',
      data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'],
        datasets: [
          {
            label: 'Investments (₹ Lakhs)',
            data: [8, 12, 9, 15, 18, 12, 16, 14, 17, 13],
            backgroundColor: 'rgba(10, 37, 64, 0.7)',
            borderColor: 'rgba(10, 37, 64, 1)',
            borderWidth: 1
          },
          {
            label: 'Payouts (₹ Lakhs)',
            data: [1.5, 1.8, 2.2, 2.5, 2.8, 2.4, 2.6, 2.9, 3.1, 2.7],
            backgroundColor: 'rgba(201, 162, 39, 0.7)',
            borderColor: 'rgba(201, 162, 39, 1)',
            borderWidth: 1
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Amount (₹ Lakhs)'
            }
          }
        }
      }
    });
  }

  const ctx2 = document.getElementById('tenureChart')?.getContext('2d');
  if (ctx2) {
    new Chart(ctx2, {
      type: 'doughnut',
      data: {
        labels: ['3 Months', '6 Months', '12 Months', '24 Months'],
        datasets: [{
          data: [15, 25, 45, 15],
          backgroundColor: [
            'rgba(10, 37, 64, 0.8)',
            'rgba(201, 162, 39, 0.8)',
            'rgba(40, 167, 69, 0.8)',
            'rgba(108, 117, 125, 0.8)'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'bottom'
          }
        }
      }
    });
  }

  // Investor Charts
  const ctx3 = document.getElementById('myInvestmentChart')?.getContext('2d');
  if (ctx3) {
    new Chart(ctx3, {
      type: 'line',
      data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'],
        datasets: [{
          label: 'Portfolio Value (₹)',
          data: [500000, 650000, 800000, 950000, 1100000, 1250000, 1300000, 1350000, 1375000, 1400000],
          backgroundColor: 'rgba(201, 162, 39, 0.1)',
          borderColor: 'rgba(201, 162, 39, 1)',
          borderWidth: 2,
          tension: 0.3,
          fill: true
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: false,
            title: {
              display: true,
              text: 'Portfolio Value (₹)'
            }
          }
        }
      }
    });
  }

  const ctx4 = document.getElementById('portfolioChart')?.getContext('2d');
  if (ctx4) {
    new Chart(ctx4, {
      type: 'pie',
      data: {
        labels: ['Commercial Real Estate', 'Fixed Income', 'Tech Startup'],
        datasets: [{
          data: [40, 28, 32],
          backgroundColor: [
            'rgba(10, 37, 64, 0.8)',
            'rgba(201, 162, 39, 0.8)',
            'rgba(40, 167, 69, 0.8)'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'bottom'
          }
        }
      }
    });
  }
}

// Load overview data for visitors
async function loadOverviewData() {
  try {
    const response = await fetch(scriptURL);
    const data = await response.json();
    if (data.success && data.overview) {
      // Update visitor overview with real data
      document.getElementById('totalInvestments').textContent = data.overview.totalInvestments || "₹2.8Cr";
      document.getElementById('totalPayouts').textContent = data.overview.totalPayouts || "₹32L";
      document.getElementById('activeInvestors').textContent = data.overview.totalInvestors || "47";
      document.getElementById('avgReturns').textContent = data.overview.avgReturns || "12.5%";
    }
  } catch (err) {
    console.error("Error loading overview:", err);
    // Fallback to static data
    document.getElementById('totalInvestments').textContent = "₹2.8Cr";
    document.getElementById('totalPayouts').textContent = "₹32L";
    document.getElementById('activeInvestors').textContent = "47";
    document.getElementById('avgReturns').textContent = "12.5%";
  }
}

// Load investor data
async function loadInvestorData(email) {
  try {
    const response = await fetch(scriptURL + "?email=" + encodeURIComponent(email));
    const data = await response.json();

    if (data.success) {
      const investor = data.investor;

      // Update investor information
      document.getElementById('investorName').textContent = investor.name || "-";
      document.getElementById('headerInvestorName').textContent = investor.name || "-";
      document.getElementById('investorEmail').textContent = investor.email || "-";
      document.getElementById('investorPhone').textContent = investor.phone || "-";
      document.getElementById('memberSince').textContent = investor.memberSince || "-";
      document.getElementById('investorConsent').textContent = investor.consent || "-";

      // Update investment summary
      document.getElementById('investorInvestment').textContent = `₹${investor.totalInvestment || 0}`;
      document.getElementById('investorPayout').textContent = `₹${investor.lastPayout || 0}`;
      document.getElementById('investorCurrentValue').textContent = `₹${investor.currentValue || 0}`;
      document.getElementById('investorROI').textContent = investor.roi || "0%";

      // Update overview stats
      document.getElementById('myTotalInvestments').textContent = `₹${investor.totalInvestment || 0}`;
      document.getElementById('myTotalPayouts').textContent = `₹${investor.lastPayout || 0}`;
      document.getElementById('currentValue').textContent = `₹${investor.currentValue || 0}`;
      document.getElementById('nextPayoutDate').textContent = investor.nextPayout || "-";

      // Render investment data
      renderInvestments(data.investments || []);
      renderPayouts(data.payouts || []);
      renderAgreements(data.agreements || []);
    } else {
      console.warn("No investor data found for", email);
    }
  } catch (err) {
    console.error("Error loading investor data:", err);
  }
}

// Render functions
function renderInvestments(investments) {
  const timeline = document.getElementById('investmentTimeline');
  if (!timeline) return;
  
  let html = '<div class="timeline">';
  investments.forEach(inv => {
    html += `
      <div class="timeline-item">
        <div class="timeline-date">${inv.date || ''}</div>
        <div class="timeline-content">
          <strong>Investment of ₹${inv.amount || 0}</strong> in ${inv.type || ''}
          <span class="badge-status badge-${inv.status === 'active' ? 'active' : 'completed'} ms-2">${inv.status || ''}</span>
        </div>
      </div>
    `;
  });
  html += '</div>';
  timeline.innerHTML = html;
}

function renderPayouts(payouts) {
  const container = document.getElementById('upcomingPayouts');
  if (!container) return;
  
  let html = '';
  payouts.forEach(p => {
    html += `
      <div class="payout-item mb-2 p-2 bg-light rounded">
        <strong>${p.date || ''}</strong>: ₹${p.amount || 0} 
        <span class="text-muted">(${p.investment || ''})</span>
      </div>
    `;
  });
  container.innerHTML = html || '<p class="text-muted">No upcoming payouts</p>';
}

function renderAgreements(agreements) {
  const container = document.getElementById('agreementsTable');
  if (!container) return;
  
  let html = '';
  agreements.forEach(a => {
    html += `
      <tr>
        <td>${a.id || 'N/A'}</td>
        <td>${a.date || ''}</td>
        <td>${a.type || ''}</td>
        <td>₹${a.amount || 0}</td>
        <td><span class="badge-status badge-${a.status === 'active' ? 'active' : 'completed'}">${a.status || ''}</span></td>
        <td>
          <a href="${a.documentUrl || '#'}" class="btn btn-sm btn-outline-primary" target="_blank">
            <i class="fas fa-download me-1"></i>Download
          </a>
        </td>
      </tr>
    `;
  });
  
  if (html === '') {
    html = `<tr><td colspan="6" class="text-center py-4 text-muted">No agreements found</td></tr>`;
  }
  
  container.innerHTML = html;
}

// Initialize FAQ accordion
function initFAQ() {
  const faqItems = document.querySelectorAll('.faq-item');
  
  faqItems.forEach(item => {
    const question = item.querySelector('.faq-question');
    
    question.addEventListener('click', () => {
      // Close all other items
      faqItems.forEach(otherItem => {
        if (otherItem !== item) {
          otherItem.classList.remove('active');
        }
      });
      
      // Toggle current item
      item.classList.toggle('active');
    });
  });
}

// Setup event listeners
function setupEventListeners() {
  // Logout button
  document.getElementById('logoutBtn')?.addEventListener('click', () => {
    localStorage.removeItem("investorEmail");
    localStorage.removeItem("consentDate");
    window.location.reload();
  });
  
  // Return calculator
  document.getElementById('calculateBtn')?.addEventListener('click', calculateReturns);
  
  // Initialize calculator with default values
  calculateReturns();
  
  // Phone number validation
  document.getElementById('phone')?.addEventListener('input', function(e) {
    this.value = this.value.replace(/\D/g, '').slice(0, 10);
  });
}

// Calculate returns
function calculateReturns() {
  const amount = parseFloat(document.getElementById('calcAmount')?.value) || 0;
  const tenure = parseInt(document.getElementById('calcTenure')?.value) || 12;
  const rate = parseFloat(document.getElementById('calcRate')?.value) || 12;
  
  const returns = (amount * rate * tenure) / 1200;
  const totalValue = amount + returns;
  
  const estimatedReturnsEl = document.getElementById('estimatedReturns');
  const totalValueEl = document.getElementById('totalValue');
  
  if (estimatedReturnsEl) {
    estimatedReturnsEl.textContent = `₹${returns.toLocaleString('en-IN')}`;
  }
  if (totalValueEl) {
    totalValueEl.textContent = `₹${totalValue.toLocaleString('en-IN')}`;
  }
}

// Validate Indian phone number
function validateIndianPhone(phone) {
  const indianPhoneRegex = /^[6-9]\d{9}$/;
  return indianPhoneRegex.test(phone);
}

// Check consent validity (annual reaffirmation)
function checkConsentValidity() {
  const lastConsent = localStorage.getItem('consentDate');
  if (lastConsent) {
    const monthsDiff = (new Date() - new Date(lastConsent)) / (1000 * 60 * 60 * 24 * 30);
    if (monthsDiff > 12) {
      // Show consent renewal notification
      console.log("Consent requires annual renewal");
      // You can implement a gentle reminder here
    }
  }
}

// Page load initialization
document.addEventListener('DOMContentLoaded', function() {
  initDashboard();
  checkConsentValidity();
});

// Consent form submission
document.getElementById('consentForm')?.addEventListener('submit', function(e) {
  e.preventDefault();
  
  const name = document.getElementById('name').value;
  const email = document.getElementById('email').value;
  const phone = document.getElementById('phone').value;
  
  // Validate phone number
  if (!validateIndianPhone(phone)) {
    alert('Please enter a valid 10-digit Indian mobile number');
    return;
  }
  
  const consentTimestamp = new Date().toISOString();
  
  // Send data to Google Sheets
  fetch(scriptURL, {
    method: "POST",
    headers: {"Content-Type": "application/x-www-form-urlencoded"},
    body: `name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}&phone=${encodeURIComponent(phone)}&consent=true&timestamp=${encodeURIComponent(consentTimestamp)}`
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // Success - store investor info and switch view
      localStorage.setItem("investorEmail", email);
      localStorage.setItem("consentDate", consentTimestamp);
      localStorage.setItem("investorName", name);
      
      consentPopup.style.display = "none";
      switchToInvestorView();
      loadInvestorData(email);
      
    } else if (data.message && data.message.includes("already exists")) {
      // Investor exists - proceed anyway
      localStorage.setItem("investorEmail", email);
      localStorage.setItem("consentDate", consentTimestamp);
      localStorage.setItem("investorName", name);
      
      consentPopup.style.display = "none";
      switchToInvestorView();
      loadInvestorData(email);
    } else {
      alert(data.message || "Error saving consent. Please try again.");
    }
  })
  .catch(err => {
    console.error("Error:", err);
    alert("Error saving consent. Please try again.");
  });
});

// Check if user is returning investor
window.onload = function() {
  const investorEmail = localStorage.getItem("investorEmail");
  if (investorEmail) {
    // User has already given consent
    switchToInvestorView();
  } else {
    // First time visitor - show consent
    switchToVisitorView();
  }
};
</script>
</body>
</html>
